---
title: "Hypothesis Testing"
---

# Introduction/Background

explain questions we try to answer with the hypothesis tests & how they work

::: panel-tabset

## Welch's two-sample t-Test (unequal variances)

<h2>Question: Do births to mothers with a chronic condition (diabetes or hypertension) have a different mean detailed birth weight (dbwt) than births to mothers without a chronic condition?</h2>

<br>

- **Null hypothesis** ($H_0$): $\mu_{chronic} = \mu_{nonchronic}$ — the mean birth weight is the same for the chronic and non‑chronic groups.
- **Alternative hypothesis** ($H_1$): $\mu_{chronic} \neq \mu_{nonchronic}$ — the mean birth weight differs between the two groups.

Hypothesis test: two-sample t-test using R's t.test() function to compare the means of the two independent groups with unequal variances.

```{r, warning=FALSE, message=FALSE, echo=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(car)
library(rstatix)
library(gt)
```

```{r}
df <- read.csv("data/cleaned/natality_cleaned.csv")

#detailed birth weight 
outcome <- "dbwt"

#creating chronic condition flag based on columns (true = chronic)
df$chronic_condition <- ifelse(
  df$rf_pdiab == 1 | df$rf_gdiab == 1 |
  df$rf_phype == 1 | df$rf_ghype == 1 |
  df$rf_ehype == 1,
  1, 0
)

#splitting into chronic vs non-chronic groups 
group_chronic <- df %>%
  filter(chronic_condition == 1) %>%
  pull(outcome)

group_nonchronic <- df %>%
  filter(chronic_condition == 0) %>%
  pull(outcome)

#running independent samples t-test 
t_test_result <- t.test(group_chronic, group_nonchronic)

print("T-Test Results:")
print(t_test_result)
```

[interpretation]

## Chi-Squared Test

<h2>Question: Are different chronic conditions independent of admission to NICU?</h2>

<br>

- **Null hypothesis** ($H_0$): The chronic condition (e.g., diabetes or hypertension) and NICU admission are independent.
- **Alternative hypothesis** ($H_1$): The chronic condition and NICU admission are not independent (i.e., there is an association between them).

<br>

### Dataset
```{r, warning=FALSE, message=FALSE}
df <- read_csv("data/cleaned/natality_cleaned.csv")

knitr::kable(head(df), caption = "Natality Dataset")
```

<br>

### Chi-Squared Tests, using R's `chisq()`

### Pre-existing Diabetes
```{r, warning=FALSE, message=FALSE}
chisq <- function(A){
  chisq.test(A)
}

# pre exsting diabetes
tab1 <- table(df$rf_pdiab, df$ab_nicu, dnn = c("Pre-existing Diabetes", "NICU Admission"))
# tab1
knitr::kable(tab1, caption = "Observed Counts of Pre-existing Diabetes vs. NICU Admission", row.names = TRUE, col.names = c("No NICU Admission", "NICU Admission"))

chi_tab1 <- chisq(tab1)
chi_tab1

# chi_tab1$expected
knitr::kable(chi_tab1$expected, caption = "Expected Counts Under Independence (Pre-existing Diabetes vs. NICU Admission)", row.names = TRUE, col.names = c("No NICU Admission", "NICU Admission"))
```

<br>

### Gestational Diabetes
```{r, warning=FALSE, message=FALSE}
# gestational diabetes
tab2 <- table(df$rf_gdiab, df$ab_nicu, dnn = c("Gestational Diabetes", "NICU Admission"))
# tab2
knitr::kable(tab2, caption = "Observed Counts of Gestational Diabetes vs. NICU Admission", row.names = TRUE, col.names = c("No NICU Admission", "NICU Admission"))

chi_tab2 <- chisq(tab2)
chi_tab2

# chi_tab2$expected
knitr::kable(chi_tab2$expected, caption = "Expected Counts Under Independence (Gestational Diabetes vs. NICU Admission)", row.names = TRUE, col.names = c("No NICU Admission", "NICU Admission"))
```

<br>

### Pre-pregnancy Hypertension
```{r, warning=FALSE, message=FALSE}
# pre-pregnancy hypertension
tab3 <- table(df$rf_phype, df$ab_nicu, dnn = c("Pre-Pregnancy Hypertension", "NICU Admission"))
# tab3
knitr::kable(tab3, caption = "Observed Counts of Pre-pregnancy Hypertension vs. NICU Admission", row.names = TRUE, col.names = c("No NICU Admission", "NICU Admission"))

chi_tab3 <- chisq(tab3)
chi_tab3

# chi_tab3$expected
knitr::kable(chi_tab3$expected, caption = "Expected Counts Under Independence (Pre-Pregnancy Hypertension vs. NICU Admission)", row.names = TRUE, col.names = c("No NICU Admission", "NICU Admission"))
```

<br>

### Gestational Hypertension
```{r, warning=FALSE, message=FALSE}
# gestational hypertension
tab4 <- table(df$rf_ghype, df$ab_nicu, dnn = c("Gestational Hypertension", "NICU Admission"))
# tab4
knitr::kable(tab4, caption = "Observed Counts of Gestational Hypertension vs. NICU Admission", row.names = TRUE, col.names = c("No NICU Admission", "NICU Admission"))

chi_tab4 <- chisq(tab4)
chi_tab4

# chi_tab4$expected
knitr::kable(chi_tab4$expected, caption = "Expected Counts Under Independence (Gestational Hypertension vs. NICU Admission)", row.names = TRUE, col.names = c("No NICU Admission", "NICU Admission"))
```

## Bootstrap

<h2>Question: Can we use bootstrap resampling to estimate the sampling distribution and confidence intervals for the mean birth weight in chronic vs. non-chronic condition groups, and assess the robustness of the observed mean difference?</h2>

<br>

### Data Preparation
```{r}
df <- read.csv("data/cleaned/natality_cleaned.csv")

# Detailed birth weight 
outcome <- "dbwt"

# Creating chronic condition flag based on columns (true = chronic)
df$chronic_condition <- ifelse(
  df$rf_pdiab == 1 | df$rf_gdiab == 1 |
  df$rf_phype == 1 | df$rf_ghype == 1 |
  df$rf_ehype == 1,
  1, 0
)

# Splitting into chronic vs non-chronic groups 
group_chronic <- df %>%
  filter(chronic_condition == 1) %>%
  pull(outcome)

group_nonchronic <- df %>%
  filter(chronic_condition == 0) %>%
  pull(outcome)
```

<br>

### Original Data Histograms
```{r}
# ===== PART 1: Original Data Histograms with Normal Overlay =====
# Save figure to file
png("plots/original_data_histograms.png", width = 1200, height = 600, res = 100)
par(mfrow = c(1, 2))

# Histogram for chronic group with normal overlay
hist(group_chronic, breaks = 50, freq = FALSE, 
     main = "Birth Weight - Chronic Conditions",
     xlab = "Birth Weight (grams)", 
     col = "coral", border = "white")
# Add normal curve overlay
mean_chronic <- mean(group_chronic, na.rm = TRUE)
sd_chronic <- sd(group_chronic, na.rm = TRUE)
curve(dnorm(x, mean = mean_chronic, sd = sd_chronic), 
      col = "darkred", lwd = 2, add = TRUE)
legend("topright", legend = "Normal Dist", col = "darkred", lwd = 2)

# Histogram for non-chronic group with normal overlay
hist(group_nonchronic, breaks = 50, freq = FALSE,
     main = "Birth Weight - No Chronic Conditions",
     xlab = "Birth Weight (grams)", 
     col = "steelblue", border = "white")
# Add normal curve overlay
mean_nonchronic <- mean(group_nonchronic, na.rm = TRUE)
sd_nonchronic <- sd(group_nonchronic, na.rm = TRUE)
curve(dnorm(x, mean = mean_nonchronic, sd = sd_nonchronic), 
      col = "darkblue", lwd = 2, add = TRUE)
legend("topright", legend = "Normal Dist", col = "darkblue", lwd = 2)
dev.off()  # Close the saved figure
```

![Original Data Histogram](plots/original_data_histograms.png)

<br>

### Bootstrap Sampling & Distribution Histograms
```{r, warning=FALSE, message=FALSE}
# ===== PART 2: Bootstrap Sampling =====
set.seed(5100)
B <- 10000

# Bootstrap for chronic group
boot_mean_chronic <- numeric(B)
n_chronic <- length(group_chronic)

for(i in 1:B) {
  boot_sample <- sample(group_chronic, n_chronic, replace = TRUE)
  boot_mean_chronic[i] <- mean(boot_sample)
}

# Bootstrap for non-chronic group
boot_mean_nonchronic <- numeric(B)
n_nonchronic <- length(group_nonchronic)

for(i in 1:B) {
  boot_sample <- sample(group_nonchronic, n_nonchronic, replace = TRUE)
  boot_mean_nonchronic[i] <- mean(boot_sample)
}
```

```{r}
# ===== PART 3: Bootstrap Distribution Histograms with Normal Overlay =====
# Save figure to file
png("plots/bootstrap_distributions.png", width = 1200, height = 600, res = 100)
par(mfrow = c(1, 2))

# Histogram for bootstrap chronic distribution with normal overlay
hist(boot_mean_chronic, breaks = 50, freq = FALSE,
     main = "Bootstrap Dist - Chronic Mean Birth Weight",
     xlab = "Mean Birth Weight (grams)", 
     col = "coral", border = "white")
# Add normal curve overlay
boot_mean_chronic_mean <- mean(boot_mean_chronic)
boot_mean_chronic_sd <- sd(boot_mean_chronic)
curve(dnorm(x, mean = boot_mean_chronic_mean, sd = boot_mean_chronic_sd), 
      col = "darkred", lwd = 2, add = TRUE)
legend("topright", legend = "Normal Dist", col = "darkred", lwd = 2)

# Histogram for bootstrap non-chronic distribution with normal overlay
hist(boot_mean_nonchronic, breaks = 50, freq = FALSE,
     main = "Bootstrap Dist - Non-Chronic Mean Birth Weight",
     xlab = "Mean Birth Weight (grams)", 
     col = "steelblue", border = "white")
# Add normal curve overlay
boot_mean_nonchronic_mean <- mean(boot_mean_nonchronic)
boot_mean_nonchronic_sd <- sd(boot_mean_nonchronic)
curve(dnorm(x, mean = boot_mean_nonchronic_mean, sd = boot_mean_nonchronic_sd), 
      col = "darkblue", lwd = 2, add = TRUE)
legend("topright", legend = "Normal Dist", col = "darkblue", lwd = 2)
dev.off()  # Close the saved figure
```

![Bootstrap Histogram](plots/bootstrap_distributions.png)

<br>

### T-Tests

#### Original T-Test
```{r}
# ===== PART 4: T-Tests =====
# Original t-test
# cat("\n===== ORIGINAL T-TEST =====\n")
t_test_result <- t.test(group_chronic, group_nonchronic)
print(t_test_result)
```
#### Bootstrap T-Test
```{r}
# Bootstrap t-test (comparing bootstrap distributions)
# cat("\n\n===== BOOTSTRAP T-TEST =====\n")
boot_t_test_result <- t.test(boot_mean_chronic, boot_mean_nonchronic)
print(boot_t_test_result)
```

<br>

### Summary Statistics
```{r}
# Summary statistics
# cat("\n\n===== SUMMARY STATISTICS =====\n")
cat("Original Data:\n")
cat(sprintf("  Chronic group: Mean = %.2f, SD = %.2f, n = %d\n", 
            mean_chronic, sd_chronic, n_chronic))
cat(sprintf("  Non-chronic group: Mean = %.2f, SD = %.2f, n = %d\n", 
            mean_nonchronic, sd_nonchronic, n_nonchronic))

cat("\nBootstrap Distributions:\n")
cat(sprintf("  Chronic bootstrap: Mean = %.2f, SD = %.2f\n", 
            boot_mean_chronic_mean, boot_mean_chronic_sd))
cat(sprintf("  Non-chronic bootstrap: Mean = %.2f, SD = %.2f\n", 
            boot_mean_nonchronic_mean, boot_mean_nonchronic_sd))
```

## ANOVA

<h2>Question: Does the presence of maternal chronic conditions (diabetes and/or hypertension) significantly affect birth weight?</h2>

<br>

- **Null hypothesis** ($H_0$): The mean birth weight is equal across all four condition groups.

$$H_0: \mu_{\text{none}} = \mu_{\text{diabetes}} = \mu_{\text{hypertension}} = \mu_{\text{both}}$$

- **Alternative hypothesis** ($H_1$):At least one condition group has a different mean birth weight compared to the others.

$$H_a: \text{At least one } \mu_i \text{ is different}$$

Significance level: $\alpha = 0.05$

<br>

### Data Preparation
```{r}
# load data
births <- read.csv("data/cleaned/natality_cleaned.csv")
# head(births)
```

```{r}
# Create condition groups for analysis
births_clean <- births |>
  mutate(
    # CBinary indicators for any diabetes
    has_diabetes = ifelse(rf_pdiab == TRUE | rf_gdiab == TRUE, 1, 0),
    
    # Binary indicator for any hypertension
    has_hypertension = ifelse(rf_phype == TRUE | rf_ghype == TRUE | 
                              rf_ehype == TRUE, 1, 0),
    
    # Create 4 condition groups
    condition_group = case_when(
      has_diabetes == 0 & has_hypertension == 0 ~ "No Conditions",
      has_diabetes == 1 & has_hypertension == 0 ~ "Diabetes Only",
      has_diabetes == 0 & has_hypertension == 1 ~ "Hypertension Only",
      has_diabetes == 1 & has_hypertension == 1 ~ "Both Conditions"
    ),
    
    # Convert to factor w/ ordered levels
    condition_group = factor(condition_group, 
                            levels = c("No Conditions", "Diabetes Only", 
                                     "Hypertension Only", "Both Conditions"))
  )

# Check sample sizes
table(births_clean$condition_group)
```

<br>

### Assumption Checks

One-way ANOVA requires three key assumptions:

- Independence: Each observation is independent (already satisfied because each birth represents a separate individual)
- Normality: Birth weights within each group are approximately normally distributed 
- Homogeneity of variance: All groups have equal variances

<br>

### Normality Check
```{r}
# Q-Q plots for each group
par(mfrow = c(2, 2))
for(group in levels(births_clean$condition_group)) {
  data_subset <- births_clean$dbwt[births_clean$condition_group == group]
  qqnorm(data_subset, main = paste("Q-Q Plot:", group))
  qqline(data_subset, col = "red")
}
par(mfrow = c(1, 1))
```

The Q-Q plots show that birth weights generally follow a normal distribution for all groups, with most points falling along the diagonal line.

<br>

### Homogeneity of Variance Check
```{r}
# Levene's test
levene_result <- leveneTest(dbwt ~ condition_group, data = births_clean)
print(levene_result)
```

The Levene's test null hypothesis is that the groups have equal variances.
Since F = 5.4543 and p = 0.0009611 (p < 0.001), we reject the null and conclude that there is strong evidence that variances differ across the groups. The homogeneity of variance assumption is violated, so we will use **Welch's ANOVA**, which is more robust to violations of the equal variance assumption.

<br>

### Welch's ANOVA
```{r}
welch_result <- oneway.test(dbwt ~ condition_group, data = births_clean, var.equal = FALSE)
print(welch_result)
```

Welch's ANOVA shows a highly significant difference in mean birth weight across the conditions levels (F = 41.96, num df = 3, denom df = 776.26, p < 2.2e-16). Therefore, we reject H0 and have enough evidence to conclude that not all group means are equal.

<br>

### Post-Hoc Tests

```{r}
# Use Games-Howell bc robust to unequal variances
games_howell <- births_clean |> games_howell_test(dbwt ~ condition_group)
print(games_howell)
```

<br>

The post-hoc test showed the following: 

- No Conditions vs. Diabetes Only: Mean difference = -0.8 g, p = 1.00 (not significant)
    - No evidence of a meaningful difference in birth weight between mothers with diabetes only and those with no conditions.
- No Conditions vs. Hypertension Only: Mean difference = -175 g, p < 0.001
    - Mothers with hypertension only have infants about 175 g lighter on average than mothers with no conditions.
- No Conditions vs. Both Conditions: Mean difference = -129 g, p = 0.004 
    - Mothers with both diabetes and hypertension have infants about 129 g lighter on average than mothers with no conditions.
- Diabetes Only vs. Hypertension Only: Mean difference = -174 g, p = 4.61e-13
    - Mothers with hypertension only have infants about 174 g lighter on average than mothers with diabetes only.
- Diabetes Only vs. Both Conditions: Mean difference = -129 g, p = 0.011 
    - Mothers with both conditions have infants about 129 g lighter on average than mothers with diabetes only.
- Hypertension Only vs. Both Conditions: Mean difference = 45.3 g, p = 0.673 (not significant)
    - No evidence of a difference in mean birth weight between hypertension-only and both-conditions groups.

Most comparisons involving the hypertension group show significant lower birth weights; the diabetes-only vs no-conditions comparison is not significant. This demonstrates taht maternal hypertension (alone or combined with diabetes) is associated with significantly lower infant birth weight, while diabetes alone does not differ significantly from no conditions.

:::